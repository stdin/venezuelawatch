---
phase: 19-gdelt-events-enrichment
plan: 01
type: execute
---

<objective>
Migrate from 37-field GDELT schema to complete 61-field schema, unlocking religion/ethnic codes, geographic precision (state/province), and enhanced actor classification.

Purpose: Maximize value from free GDELT BigQuery data by using all available fields for richer risk intelligence and regional analysis.
Output: All 61 GDELT Events table fields queried, stored, and available to intelligence pipeline and API consumers.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-gdelt-events-enrichment/19-CONTEXT.md
@.planning/phases/14.2-gdelt-bigquery-native-migrate-to-gdelt-native-dataset/14.2-01-SUMMARY.md
@backend/api/services/gdelt_bigquery_service.py
@backend/data_pipeline/tasks/gdelt_sync_task.py

**Current State:**
- Phase 14.2 established GDELT BigQuery federation (37 fields)
- Query: `gdelt-bq.gdeltv2.events_partitioned` table
- Storage: Metadata JSON in BigQuery events table
- Missing: 24 high-value fields (religion, ethnicity, ADM codes, feature IDs)

**Vision from 19-CONTEXT.md:**
Complete replacement — swap from 37 to 61 fields, rebuild around GDELT's full schema. Use all fields immediately (quotations, themes, tone, counts, images). Foundation for future source-specific schemas.

**Key Constraints:**
- No breaking changes to existing metadata structure
- Preserve LLM analysis dispatch pattern
- Keep query performance (partition filtering)
- GKG/Mentions tables deferred to Phases 20-21
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand GDELT BigQuery Query to All 61 Fields</name>
  <files>backend/api/services/gdelt_bigquery_service.py</files>
  <action>
Add 24 missing fields to `get_venezuela_events()` SELECT statement in alphabetical/logical order:

**Religion Context (4 fields):**
- Actor1Religion1Code
- Actor1Religion2Code
- Actor2Religion1Code
- Actor2Religion2Code

**Ethnicity Context (2 fields):**
- Actor1EthnicCode
- Actor2EthnicCode

**Actor Classification (4 fields):**
- Actor1KnownGroupCode
- Actor1Type2Code
- Actor2KnownGroupCode
- Actor2Type3Code

**Geographic Precision (9 fields):**
- Actor1Geo_ADM1Code (state/province)
- Actor1Geo_ADM2Code (county/district)
- Actor1Geo_FeatureID (GNS/GNIS identifier)
- Actor2Geo_ADM1Code
- Actor2Geo_ADM2Code
- Actor2Geo_FeatureID
- ActionGeo_ADM1Code
- ActionGeo_ADM2Code
- ActionGeo_FeatureID

Insert new fields in their logical groups (after Actor1Code add Actor1Religion1Code, etc.) to maintain readability.

**What to avoid:** Don't add GKG fields (V2Themes, V2Quotations) or EventMentions fields—those are separate tables for Phases 20-21. Only add fields from the Events table.

**Why:** GDELT Events table has exactly 61 fields. Adding all fields unlocks religious/ethnic tracking, regional analysis (Zulia border, Caracas protests), and better entity classification without additional queries.
  </action>
  <verify>Query runs successfully against gdelt-bq.gdeltv2.events_partitioned, returns dict with 61 keys</verify>
  <done>All 61 GDELT Events table fields present in query result, no BigQuery schema errors</done>
</task>

<task type="auto">
  <name>Task 2: Update Sync Task Metadata Mapping</name>
  <files>backend/data_pipeline/tasks/gdelt_sync_task.py</files>
  <action>
Extend the `metadata` dict in `sync_gdelt_events()` function (around line 123-137) to include all 24 new fields.

Organize additions by category for clarity:

```python
metadata={
    # Existing fields (keep as-is)
    'goldstein_scale': gdelt_event.get('GoldsteinScale'),
    'avg_tone': gdelt_event.get('AvgTone'),
    # ... existing fields ...

    # NEW: Religion & Ethnicity
    'actor1_religion1_code': gdelt_event.get('Actor1Religion1Code'),
    'actor1_religion2_code': gdelt_event.get('Actor1Religion2Code'),
    'actor2_religion1_code': gdelt_event.get('Actor2Religion1Code'),
    'actor2_religion2_code': gdelt_event.get('Actor2Religion2Code'),
    'actor1_ethnic_code': gdelt_event.get('Actor1EthnicCode'),
    'actor2_ethnic_code': gdelt_event.get('Actor2EthnicCode'),

    # NEW: Enhanced Actor Classification
    'actor1_known_group_code': gdelt_event.get('Actor1KnownGroupCode'),
    'actor1_type2_code': gdelt_event.get('Actor1Type2Code'),
    'actor2_known_group_code': gdelt_event.get('Actor2KnownGroupCode'),
    'actor2_type3_code': gdelt_event.get('Actor2Type3Code'),

    # NEW: Geographic Precision
    'actor1_geo_adm1': gdelt_event.get('Actor1Geo_ADM1Code'),
    'actor1_geo_adm2': gdelt_event.get('Actor1Geo_ADM2Code'),
    'actor1_geo_feature_id': gdelt_event.get('Actor1Geo_FeatureID'),
    'actor2_geo_adm1': gdelt_event.get('Actor2Geo_ADM1Code'),
    'actor2_geo_adm2': gdelt_event.get('Actor2Geo_ADM2Code'),
    'actor2_geo_feature_id': gdelt_event.get('Actor2Geo_FeatureID'),
    'action_geo_adm1': gdelt_event.get('ActionGeo_ADM1Code'),
    'action_geo_adm2': gdelt_event.get('ActionGeo_ADM2Code'),
    'action_geo_feature_id': gdelt_event.get('ActionGeo_FeatureID'),
}
```

Use snake_case for metadata keys (not GDELT's original capitalization) for consistency with existing metadata pattern.

**Preserve:** LLM analysis dispatch (`analyze_task.delay(event.id, model='fast')`) unchanged.

**What to avoid:** Don't modify the deduplication logic, date parsing, or event type mapping—only extend metadata dict.

**Why:** Flexible metadata JSON field allows schema extension without database migrations. All new fields immediately available to LLM analysis and API consumers.
  </action>
  <verify>Sync task runs successfully (test with lookback_minutes=1440), metadata contains 37 existing + 24 new fields</verify>
  <done>All 61 GDELT fields stored in BigQuery events.metadata, task completes without errors</done>
</task>

<task type="auto">
  <name>Task 3: Create GDELT Field Reference Utilities</name>
  <files>backend/api/services/gdelt_field_reference.py</files>
  <action>
Create new utility module with CAMEO code lookups and helper functions:

```python
"""
GDELT field reference utilities for CAMEO codes and geographic types.

Provides human-readable descriptions for GDELT codes without exhaustive tables.
Focus on Venezuela-relevant codes and common patterns.
"""
from typing import Optional

# Common CAMEO Actor Codes (Venezuela-relevant subset)
CAMEO_ACTOR_CODES = {
    'GOV': 'Government',
    'MIL': 'Military',
    'REB': 'Rebel/Opposition',
    'JUD': 'Judiciary',
    'LEG': 'Legislature',
    'COP': 'Police',
    'CVL': 'Civilian',
    'BUS': 'Business',
    'MED': 'Media',
    'EDU': 'Education',
    'NGO': 'NGO',
    'IGO': 'International Govt Org',
    # Add more as needed for Venezuela context
}

# CAMEO Event Code Categories (root codes)
CAMEO_EVENT_CODES = {
    '01': 'Make Public Statement',
    '02': 'Appeal',
    '03': 'Express Intent to Cooperate',
    '04': 'Consult',
    '05': 'Engage in Diplomatic Cooperation',
    '06': 'Engage in Material Cooperation',
    '07': 'Provide Aid',
    '08': 'Yield',
    '09': 'Investigate',
    '10': 'Demand',
    '11': 'Disapprove',
    '12': 'Reject',
    '13': 'Threaten',
    '14': 'Protest',
    '15': 'Exhibit Force Posture',
    '16': 'Reduce Relations',
    '17': 'Coerce',
    '18': 'Assault',
    '19': 'Fight',
    '20': 'Use Unconventional Mass Violence',
}

# Geographic Type Codes
GEO_TYPE_CODES = {
    1: 'Country',
    2: 'State/Province',
    3: 'City/District',
    4: 'Landmark',
    5: 'Coordinate',
}

# QuadClass Descriptions
QUAD_CLASS_NAMES = {
    1: 'Verbal Cooperation',
    2: 'Material Cooperation',
    3: 'Verbal Conflict',
    4: 'Material Conflict',
}


def decode_actor_code(code: Optional[str]) -> str:
    """Get human-readable description for CAMEO actor code."""
    if not code:
        return 'Unknown'

    # Check first 3 characters for standard codes
    prefix = code[:3] if len(code) >= 3 else code
    return CAMEO_ACTOR_CODES.get(prefix, code)


def decode_event_code(code: Optional[str]) -> str:
    """Get human-readable description for CAMEO event code."""
    if not code:
        return 'Unknown Event'

    # Use root code (first 2 digits)
    root = code[:2] if len(code) >= 2 else code
    return CAMEO_EVENT_CODES.get(root, f'Event {code}')


def get_geo_type_name(geo_type: Optional[int]) -> str:
    """Get geographic resolution type name."""
    if geo_type is None:
        return 'Unknown'
    return GEO_TYPE_CODES.get(geo_type, f'Type {geo_type}')


def get_quad_class_name(quad_class: Optional[int]) -> str:
    """Get QuadClass category name."""
    if quad_class is None:
        return 'Unknown'
    return QUAD_CLASS_NAMES.get(quad_class, f'Class {quad_class}')
```

**What to avoid:** Don't include exhaustive CAMEO code tables (hundreds of codes). Focus on common Venezuela-relevant codes and utility functions. Full lookups can be added later if needed.

**Why:** Provides human-readable interpretations for GDELT codes without bloating the codebase. Utilities can be used by API endpoints, LLM prompts, or dashboard tooltips.
  </action>
  <verify>Module imports successfully, functions return correct descriptions for sample codes (decode_actor_code('GOV'), decode_event_code('14'), etc.)</verify>
  <done>Utility module created, all functions work correctly, module importable from api.services</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] GDELT query returns all 61 fields (verify with test script)
- [ ] Sync task runs without errors (test with 24-hour lookback)
- [ ] Metadata contains all new fields (inspect BigQuery events table)
- [ ] Field reference utilities work (import and test decode functions)
- [ ] No breaking changes to existing intelligence pipeline
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- GDELT BigQuery service queries 61 fields (not 37)
- Sync task stores 61 fields in metadata
- Field reference utilities functional
- No errors in Django check or test runs
- Existing LLM analysis pattern preserved
  </success_criteria>

<output>
After completion, create `.planning/phases/19-gdelt-events-enrichment/19-01-SUMMARY.md`:

# Phase 19 Plan 01: GDELT Events Enrichment Summary

**All 61 GDELT Events fields now captured—unlocking religion/ethnic codes, state/province tracking, and enhanced actor classification.**

## Accomplishments

- Expanded GDELT BigQuery query from 37 to 61 fields
- Added religion context (4 fields), ethnicity (2 fields), actor classification (4 fields), geographic precision (9 fields)
- Updated sync task metadata mapping for all new fields
- Created GDELT field reference utilities for human-readable code interpretation

## Files Created/Modified

- `backend/api/services/gdelt_bigquery_service.py` - Added 24 fields to query
- `backend/data_pipeline/tasks/gdelt_sync_task.py` - Extended metadata dict
- `backend/api/services/gdelt_field_reference.py` - Created CAMEO code utilities

## Decisions Made

- Organized metadata by category (religion, ethnicity, geography) for clarity
- Used snake_case metadata keys for consistency
- Focused field reference on Venezuela-relevant codes (not exhaustive tables)
- Deferred GKG/Mentions tables to Phases 20-21 per roadmap

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

**Ready for Phase 20: GKG Integration**
- All Events table fields captured
- Foundation for GKG join on GLOBALEVENTID established
- Metadata pattern proven for additional enrichment

**Note:** Phase 19 sets the pattern for source-specific schemas. When adding other data sources (FRED, ReliefWeb), they can each maintain native field structures in separate metadata namespaces.
</output>
