---
phase: 07-ai-chat-interface
plan: 02
type: execute
---

<objective>
Integrate assistant-ui React library with custom runtime connecting to Django chat API.

Purpose: Set up the frontend chat infrastructure with assistant-ui primitives, custom runtime for Django SSE streaming, and TypeScript types.
Output: Chat provider component with working message streaming from Django backend.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-ai-chat-interface/07-CONTEXT.md
@.planning/phases/07-ai-chat-interface/07-01-SUMMARY.md
@frontend/package.json
@frontend/src/lib/types.ts
@frontend/src/lib/api.ts

**Tech stack available:**
- React 19.2.0
- TypeScript
- Vite for build
- Existing API client pattern in src/lib/api.ts

**From 07-01:**
- Backend /api/chat endpoint streams SSE responses
- Tools: search_events, get_entity_profile, get_trending_entities, analyze_risk_trends
- Message format: {role: "user"|"assistant", content: string}

**From CONTEXT.md:**
- Chat-first experience (not sidebar)
- Natural conversation with context retention
- Rich preview cards for events/entities (handled in later plan)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install assistant-ui and configure dependencies</name>
  <files>frontend/package.json</files>
  <action>
Install assistant-ui React packages:
- @assistant-ui/react (core library)
- @assistant-ui/react-markdown (markdown rendering)
- remark-gfm (GitHub flavored markdown)

Run: npm install @assistant-ui/react @assistant-ui/react-markdown remark-gfm

DO NOT install Vercel AI SDK packages (@ai-sdk/*, ai) - we're using custom Django backend, not Next.js API routes.

Verify package.json updated correctly.
  </action>
  <verify>npm list shows @assistant-ui/react, @assistant-ui/react-markdown, remark-gfm installed</verify>
  <done>Dependencies installed, package.json includes assistant-ui packages</done>
</task>

<task type="auto">
  <name>Task 2: Create custom runtime for Django SSE streaming</name>
  <files>frontend/src/lib/chatRuntime.ts, frontend/src/lib/types.ts</files>
  <action>
Create frontend/src/lib/chatRuntime.ts implementing custom assistant-ui runtime using useExternalStoreRuntime pattern.

Key implementation:
1. Define ChatMessage type matching Django backend format: {role: "user"|"assistant", content: string}
2. Create useChatRuntime hook that:
   - Maintains messages state (useState)
   - Implements onNew handler for user messages
   - Fetches from /api/chat with POST {messages: [...messages, userMessage]}
   - Parses SSE stream (EventSource or fetch with ReadableStream)
   - Appends assistant message chunks as they arrive
   - Uses useExternalStoreRuntime to create assistant-ui compatible runtime

3. Handle streaming:
   - Use fetch() with response.body.getReader()
   - Parse "data: {json}\n\n" SSE format
   - Accumulate text chunks into single assistant message
   - Update message state reactively

4. Error handling:
   - Network errors show error message in chat
   - Invalid JSON in SSE handled gracefully
   - Tool execution errors displayed to user

Add TypeScript types to src/lib/types.ts for ChatMessage, ToolCall, ToolResult.

DO NOT use useChatRuntime from @assistant-ui/react-ai-sdk (that's for Vercel AI SDK). Build custom runtime with useExternalStoreRuntime.
  </action>
  <verify>Import useChatRuntime hook, call it, verify runtime object has required properties (messages, append, reload, etc)</verify>
  <done>Custom runtime created, connects to Django API, streams responses, manages conversation state</done>
</task>

<task type="auto">
  <name>Task 3: Create ChatProvider component wrapping runtime</name>
  <files>frontend/src/components/ChatProvider.tsx</files>
  <action>
Create ChatProvider component that:
1. Calls useChatRuntime() hook
2. Wraps children in AssistantRuntimeProvider from @assistant-ui/react
3. Exports for use in app

Pattern:
```tsx
export function ChatProvider({ children }: { children: React.ReactNode }) {
  const runtime = useChatRuntime();

  return (
    <AssistantRuntimeProvider runtime={runtime}>
      {children}
    </AssistantRuntimeProvider>
  );
}
```

This provider will be used in Chat page (created in next plan).
  </action>
  <verify>Component compiles without TypeScript errors, can be imported</verify>
  <done>ChatProvider component created, wraps runtime provider, ready for use</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm install completed successfully
- [ ] @assistant-ui/react installed and importable
- [ ] Custom runtime hook defined in chatRuntime.ts
- [ ] Runtime connects to /api/chat endpoint
- [ ] SSE streaming parsed correctly
- [ ] ChatProvider component exports cleanly
- [ ] No TypeScript compilation errors
</verification>

<success_criteria>

- assistant-ui dependencies installed
- Custom runtime implemented with Django SSE integration
- ChatProvider component ready for app integration
- Message state management working
- TypeScript types defined for chat messages
- No compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-ai-chat-interface/07-02-SUMMARY.md`
</output>
