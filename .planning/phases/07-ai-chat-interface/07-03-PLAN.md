---
phase: 07-ai-chat-interface
plan: 03
type: execute
---

<objective>
Build custom tool UI components for rich event and entity preview cards in chat responses.

Purpose: Implement Perplexity-style rich previews when AI cites events or entities - showing metadata, visual indicators, and contextual explanations inline.
Output: EventPreviewCard and EntityPreviewCard components that render tool results with expand-in-place functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-ai-chat-interface/07-CONTEXT.md
@.planning/phases/07-ai-chat-interface/07-01-SUMMARY.md
@.planning/phases/07-ai-chat-interface/07-02-SUMMARY.md
@frontend/src/components/EventCard.tsx
@frontend/src/components/EntityLeaderboard.tsx
@frontend/src/lib/types.ts

**Tech stack available:**
- assistant-ui with makeAssistantToolUI for custom tool rendering
- Existing EventCard and EntityLeaderboard components for styling patterns
- CSS patterns: severity badges, entity type colors, risk score displays

**From 07-01:**
- Tools: search_events, get_entity_profile, get_trending_entities, analyze_risk_trends
- Tool response formats defined in backend/chat/tools.py

**From CONTEXT.md:**
- Preview cards must show: metadata (date, source, risk score), visual indicators (severity badges, trend arrows), contextual explanation
- Cards expand in-place (not navigate away)
- Perplexity-style with inline citations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EventPreviewCard tool UI component</name>
  <files>frontend/src/components/chat/EventPreviewCard.tsx, frontend/src/components/chat/EventPreviewCard.css</files>
  <action>
Create EventPreviewCard using makeAssistantToolUI from @assistant-ui/react.

Tool name: "search_events"

Component displays:
1. **Compact view** (default):
   - Event title (truncated to 2 lines)
   - Date and source badge
   - Risk score with color coding (red >70, yellow 40-70, green <40)
   - Severity badge (SEV1-5 with colors)
   - "Show details" button

2. **Expanded view** (on click):
   - Full title
   - Complete event summary
   - All metadata visible
   - Risk score breakdown if available
   - Source link
   - "Collapse" button

Use useState for expand/collapse toggle. Style to match existing EventCard.tsx patterns but optimized for inline chat display (more compact).

TypeScript types for args: {date_from?, date_to?, risk_threshold?, source?, limit?}
TypeScript types for result: {events: Array<{id, title, date, source, risk_score, severity, summary}>}

Render list of events, each as expandable card.
  </action>
  <verify>Component renders without errors, displays event data, expand/collapse works</verify>
  <done>EventPreviewCard component created, renders search_events tool results, expandable cards work correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create EntityPreviewCard tool UI component</name>
  <files>frontend/src/components/chat/EntityPreviewCard.tsx, frontend/src/components/chat/EntityPreviewCard.css</files>
  <action>
Create EntityPreviewCard using makeAssistantToolUI from @assistant-ui/react.

Tool name: "get_entity_profile"

Component displays:
1. **Compact view** (default):
   - Entity name with type badge (Person=blue, Organization=purple, Government=red, Location=green)
   - Mention count with trend arrow
   - Sanctions status (red alert if sanctioned)
   - Average risk score
   - "Show profile" button

2. **Expanded view** (on click):
   - Full profile details
   - Recent mentions list (last 5)
   - Risk score trend
   - All metadata visible
   - "Collapse" button

Use useState for expand/collapse. Style matches existing EntityProfile.tsx patterns but compact for inline chat.

TypeScript types for args: {entity_name: string}
TypeScript types for result: {entity: {name, type, mention_count, avg_risk_score, is_sanctioned, recent_mentions}}

Also create TrendingEntitiesCard for "get_trending_entities" tool showing simple list with trend indicators.
  </action>
  <verify>Component renders entity data correctly, expand/collapse works, sanctions badge displays properly</verify>
  <done>EntityPreviewCard and TrendingEntitiesCard created, render tool results with visual indicators and expand functionality</done>
</task>

<task type="auto">
  <name>Task 3: Create RiskTrendsChart tool UI component</name>
  <files>frontend/src/components/chat/RiskTrendsChart.tsx, frontend/src/components/chat/RiskTrendsChart.css</files>
  <action>
Create RiskTrendsChart using makeAssistantToolUI from @assistant-ui/react.

Tool name: "analyze_risk_trends"

Component displays:
- Line chart showing risk scores over time
- Use recharts library (already installed) with LineChart, XAxis, YAxis, Line, Tooltip
- Color-coded by risk level (gradient from green to red)
- Date range label
- Compact chart optimized for inline chat display (smaller than dashboard TrendsPanel)

TypeScript types for args: {days_back: number, event_types?: string[]}
TypeScript types for result: {trends: Array<{date: string, avg_risk_score: number}>}

Follow TrendsPanel.tsx patterns but make more compact.
  </action>
  <verify>Chart renders with data, dates on x-axis, risk scores on y-axis, interactive tooltip works</verify>
  <done>RiskTrendsChart component created, renders analyze_risk_trends tool results as compact line chart</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 4 tool UI components created (EventPreviewCard, EntityPreviewCard, TrendingEntitiesCard, RiskTrendsChart)
- [ ] Components use makeAssistantToolUI correctly
- [ ] Tool names match backend definitions
- [ ] TypeScript types match tool response schemas
- [ ] Expand/collapse functionality works
- [ ] Visual indicators (badges, colors) display correctly
- [ ] Components compile without errors
</verification>

<success_criteria>

- Custom tool UI components for all 4 VenezuelaWatch tools
- Rich previews show metadata, visual indicators, and context
- Expand-in-place functionality working
- Styling consistent with existing components
- TypeScript types defined and correct
- No compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-ai-chat-interface/07-03-SUMMARY.md`
</output>
