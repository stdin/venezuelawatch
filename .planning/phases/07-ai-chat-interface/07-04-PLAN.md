---
phase: 07-ai-chat-interface
plan: 04
type: execute
---

<objective>
Build Chat page UI with Perplexity-style design, integrate assistant-ui Thread component, and add navigation.

Purpose: Complete the chat interface with clean layout, message display, input composer, and integrate all components into the app.
Output: Functional /chat page with working AI conversation interface.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-ai-chat-interface/07-CONTEXT.md
@.planning/phases/07-ai-chat-interface/07-01-SUMMARY.md
@.planning/phases/07-ai-chat-interface/07-02-SUMMARY.md
@.planning/phases/07-ai-chat-interface/07-03-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/pages/Dashboard.tsx
@frontend/src/pages/Entities.tsx

**Tech stack available:**
- assistant-ui Thread component for message display
- ChatProvider with custom runtime (from 07-02)
- Tool UI components (from 07-03)
- React Router for navigation
- Existing nav pattern in App.tsx

**From CONTEXT.md:**
- Perplexity-style: clean, research-oriented, center-focused
- Separate /chat route (peer to /dashboard and /entities)
- Suggested follow-up questions after responses
- Markdown rendering with inline citations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Chat page component with assistant-ui Thread</name>
  <files>frontend/src/pages/Chat.tsx, frontend/src/pages/Chat.css</files>
  <action>
Create Chat page using assistant-ui primitives:

1. Import Thread from @assistant-ui/react
2. Wrap in ChatProvider component (from 07-02)
3. Register tool UI components (EventPreviewCard, EntityPreviewCard, etc from 07-03)
4. Customize Thread with MarkdownText component for message rendering

Layout:
- Center-focused design (max-width: 44rem like Perplexity)
- Full-height viewport
- Clean, minimal styling
- Thread component handles message list, composer, scroll behavior

Thread customization:
- Use ThreadPrimitive.Root with custom className
- ThreadPrimitive.Viewport for scrollable message area
- ThreadPrimitive.Messages for message rendering
- Built-in Composer component at bottom
- ThreadPrimitive.Empty for welcome message

Welcome message:
- "How can I help you with Venezuela intelligence today?"
- 3-4 ThreadPrimitive.Suggestion chips with example queries:
  - "What are today's high-risk events?"
  - "Show me trending entities this week"
  - "Analyze risk trends for the last 30 days"
  - "Who is affected by recent sanctions?"

Style to match Linear/Perplexity aesthetic - clean, spacious, research-oriented.
  </action>
  <verify>Chat.tsx compiles, renders Thread component, welcome message displays</verify>
  <done>Chat page created with assistant-ui Thread, suggestion chips, markdown rendering, tool UI components registered</done>
</task>

<task type="auto">
  <name>Task 2: Add /chat route and navigation integration</name>
  <files>frontend/src/App.tsx, frontend/src/App.css</files>
  <action>
Integrate Chat page into app:

1. Add /chat route to React Router:
   - Import Chat page
   - Add Route element: <Route path="/chat" element={<Chat />} />

2. Add "Chat" nav link to header/sidebar alongside Dashboard and Entities:
   - Update navigation UI with "Chat" button
   - Active state styling when on /chat route
   - Icon: message circle or chat bubble

3. Update CSS for nav active states to include /chat

Follow existing nav pattern from Dashboard/Entities integration in App.tsx.
  </action>
  <verify>Navigate to /chat shows Chat page, nav link highlights correctly, switching between pages works</verify>
  <done>Chat route added, navigation updated with Chat link, active states work correctly</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete AI chat interface with streaming responses, tool-based data access, and rich preview cards</what-built>
  <how-to-verify>
1. Start dev servers:
   - Backend: cd backend && python manage.py runserver
   - Frontend: cd frontend && npm run dev

2. Visit http://localhost:5173/chat

3. Test conversation flow:
   - Try: "What are the highest risk events today?"
   - Verify: AI responds, search_events tool executes, EventPreviewCard appears
   - Click "Show details" on an event card - should expand inline

4. Test entity queries:
   - Try: "Tell me about PDVSA"
   - Verify: get_entity_profile tool executes, EntityPreviewCard shows data
   - Expand entity card - should show full profile

5. Test analytical queries:
   - Try: "Show me risk trends for the last 7 days"
   - Verify: analyze_risk_trends tool executes, RiskTrendsChart renders

6. Test conversation context:
   - After previous query, try: "What caused that spike?"
   - Verify: Claude remembers previous context

7. Test navigation:
   - Click between Dashboard, Entities, and Chat tabs
   - Verify: navigation works, active states update correctly

8. Check styling:
   - Chat interface should feel clean and research-oriented
   - Preview cards should be visually distinct and informative
   - Markdown formatting should render correctly

Expected behavior:
- Streaming responses appear incrementally
- Tool UI components render with correct data
- Expand/collapse works on preview cards
- Navigation between pages works smoothly
- No console errors
  </how-to-verify>
  <resume-signal>Type "approved" if everything works, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Chat page component created and styled
- [ ] Thread component integrated with custom runtime
- [ ] Tool UI components registered
- [ ] Welcome message with suggestion chips displays
- [ ] /chat route added to React Router
- [ ] Navigation updated with Chat link
- [ ] Manual testing confirms full chat flow works
- [ ] npm run build completes without errors
</verification>

<success_criteria>

- Chat page functional at /chat route
- AI responses stream correctly from Django backend
- Tool calling works for all 4 data access tools
- Rich preview cards display event and entity data
- Expand-in-place functionality works
- Conversation context maintained
- Navigation integrated with Dashboard and Entities
- Perplexity-style clean design achieved
- Phase 7 complete - AI Chat Interface shipped
</success_criteria>

<output>
After completion, create `.planning/phases/07-ai-chat-interface/07-04-SUMMARY.md`
</output>
