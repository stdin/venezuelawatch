---
phase: 05-dashboard-events-feed
plan: 04
type: execute
---

<objective>
Build event detail panel with comprehensive information and basic trend charts showing risk over time.

Purpose: Complete the dashboard with deep event context and visual risk trends.
Output: Working detail panel showing full event data, risk breakdown, related events, metadata, plus line charts showing risk trends and event distribution.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-dashboard-events-feed/05-CONTEXT.md
@.planning/phases/05-dashboard-events-feed/05-03-SUMMARY.md
@frontend/src/pages/Dashboard.tsx
@frontend/src/lib/types.ts
@frontend/src/components/EventCard.tsx

**Tech stack available:**
- RiskEvent interface with all fields
- useRiskEvents hook returns events array
- Split-view Dashboard with right panel placeholder
- React 19 with TypeScript

**From CONTEXT.md detail view requirements:**
- Full event description and source links
- Risk breakdown (why this score? - show dimension contributions)
- Related events from same source/topic
- All metadata (severity, sentiment, categories, tags)

**From CONTEXT.md trends requirement:**
- Basic charts showing risk over time
- Events by category distribution
- Provides context for current risk snapshot

**Constraining decisions:**
- Phase 4: Risk score = weighted sum of 5 dimensions (LLM 25%, Sanctions 30%, Sentiment 20%, Urgency 15%, Supply Chain 10%)
- Phase 4: Weights vary by event type
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts for trend visualization</name>
  <files>frontend/package.json</files>
  <action>
Install recharts for React charting:

```bash
cd frontend && npm install recharts
```

Recharts provides declarative chart components with ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend. No additional dependencies needed.
  </action>
  <verify>grep "recharts" frontend/package.json shows installation</verify>
  <done>Package installed in dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create EventDetail component with comprehensive information display</name>
  <files>frontend/src/components/EventDetail.tsx, frontend/src/components/EventDetail.css</files>
  <action>
Create EventDetail component showing full event context:

**EventDetail.tsx props:**
- event: RiskEvent | null
- allEvents: RiskEvent[] (for finding related events)

**If event is null:** Show "Select an event to view details"

**If event exists, display sections:**

1. **Header:**
   - Title (large, bold)
   - Source badge, timestamp
   - Risk score (large, color-coded), Severity badge

2. **Full Description:**
   - Summary text (from event.summary)
   - Full content if available (event.content as formatted JSON or extract text fields)
   - Source links (event.content.url if exists, open in new tab)

3. **Risk Breakdown:**
   - Show "How this risk score was calculated:"
   - LLM Base Risk: 25% weight
   - Sanctions: 30% weight (highlight if event.sanctions_matches.length > 0)
   - Sentiment: 20% weight (show event.sentiment value)
   - Urgency: 15% weight (show event.urgency)
   - Supply Chain: 10% weight
   - Note: "Weights vary by event type" subtext
   - Visual bar or percentage display for each dimension

4. **Sanctions Matches** (if any):
   - List sanctions_matches with entity_name, type, list, confidence
   - Highlight high confidence matches (>0.8)

5. **Metadata:**
   - Themes: event.themes as tags
   - Entities: event.entities as tags
   - Event type: event.event_type
   - Sentiment: event.sentiment (-1 to 1, show as positive/neutral/negative)

6. **Related Events:**
   - Filter allEvents for same source OR overlapping themes (at least 1 theme match)
   - Show 3-5 related events as mini-cards (title, risk score, timestamp)
   - Click related event should update parent selection

**EventDetail.css:**
- Scrollable container (overflow-y auto)
- Sections clearly separated (borders, spacing)
- Tags/badges styled consistently with EventCard
- Risk breakdown visual (progress bars or percentages)
- Clean typography hierarchy
- Responsive padding

Component should handle missing fields gracefully (some events may not have all metadata).
  </action>
  <verify>EventDetail renders all sections, handles null event, related events display correctly</verify>
  <done>Comprehensive event detail view implemented with all required information</done>
</task>

<task type="auto">
  <name>Task 3: Create TrendsPanel component with Recharts visualizations</name>
  <files>frontend/src/components/TrendsPanel.tsx, frontend/src/components/TrendsPanel.css</files>
  <action>
Create TrendsPanel component with two charts:

**TrendsPanel.tsx props:**
- events: RiskEvent[]

**Charts to render:**

1. **Risk Over Time (LineChart):**
   - X-axis: timestamp (grouped by day)
   - Y-axis: average risk score (0-100)
   - Data processing: group events by day, calculate avg risk_score per day
   - Use Recharts: ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip
   - Line color: use --risk-critical from CSS variables
   - Show last 30 days only (filter events by timestamp)
   - Height: 250px

2. **Events by Category (LineChart or BarChart):**
   - X-axis: event_type
   - Y-axis: count of events
   - Data processing: count events grouped by event_type (POLITICAL, ECONOMIC, etc.)
   - Use Recharts: ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip
   - Bars color-coded by category
   - Height: 200px

**Layout:**
- Vertical stack: Risk trend on top, category distribution below
- Section titles: "Risk Trend (Last 30 Days)", "Events by Category"
- Responsive: charts use ResponsiveContainer width="100%"

**Data processing helpers:**
- groupEventsByDay(events): returns array of { date: string, avgRisk: number }
- countEventsByType(events): returns array of { type: string, count: number }

**TrendsPanel.css:**
- Container padding, background subtle difference from main panels
- Section titles bold
- Chart containers with borders/shadows

Handle edge cases: no events (show "No data available"), single event (show anyway).
  </action>
  <verify>Charts render with sample data, responsive, tooltips work, data calculations correct</verify>
  <done>Two trend charts implemented showing risk over time and event distribution</done>
</task>

<task type="auto">
  <name>Task 4: Integrate EventDetail and TrendsPanel into Dashboard</name>
  <files>frontend/src/pages/Dashboard.tsx, frontend/src/pages/Dashboard.css</files>
  <action>
Update Dashboard to show detail panel and trends:

**In detail-panel (right side):**
- Replace placeholder with:
  - TrendsPanel at top (always visible)
  - Horizontal divider
  - EventDetail below (shows selected event or "Select an event")

**Layout adjustments:**
- detail-panel should scroll independently (overflow-y auto)
- TrendsPanel position: sticky at top of detail-panel (optional, keeps charts visible while scrolling)
- Pass selectedEventId to find selected event from events array
- Pass events to TrendsPanel, selectedEvent + allEvents to EventDetail

**State management:**
- When event selected in EventList, update selectedEventId state
- Find selected event: events.find(e => e.id === selectedEventId)
- Pass to EventDetail

**CSS updates (Dashboard.css):**
- detail-panel: overflow-y auto for scrolling
- Ensure TrendsPanel doesn't take too much vertical space (max-height constraints if needed)

Import EventDetail and TrendsPanel components.
  </action>
  <verify>Detail panel shows trends + event details, scrolling works, selection updates detail view</verify>
  <done>Dashboard complete with trends and detail panel, fully integrated</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Event detail panel with comprehensive info and trend charts</what-built>
  <how-to-verify>
1. Start dev servers and visit dashboard with filters applied
2. Test TrendsPanel (always visible in right panel):
   - Verify "Risk Trend (Last 30 Days)" chart shows line graph
   - Verify risk scores change over time (should reflect events data)
   - Verify "Events by Category" chart shows distribution
   - Hover over data points - tooltips should appear
   - Resize browser window - charts should be responsive
3. Test EventDetail (click an event in list):
   - Header shows title, source, timestamp, risk score, severity
   - Full description section shows event summary
   - Risk breakdown shows all 5 dimensions with weights
   - If event has sanctions matches - section appears with entity details
   - Metadata shows themes (tags), entities, event type, sentiment
   - Related events section shows 3-5 similar events
   - Click related event - detail view updates to that event
4. Test with different event types:
   - Select high-risk event (>75 risk score) - risk breakdown should show contributing factors
   - Select event with sanctions - sanctions matches section appears
   - Select event without sanctions - section absent (not shown)
   - Select different event types (Political, Economic) - metadata reflects correctly
5. Test edge cases:
   - With no event selected - shows "Select an event to view details"
   - With single event in list - trends still render
   - With empty filters (no events) - trends show "No data available"
6. Verify overall dashboard flow:
   - Left panel: filtered, virtualized event list
   - Right panel: trends always visible + detail for selected event
   - Smooth interaction, no lag when selecting events
   - Clean, professional aesthetic matching Linear inspiration
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] Recharts installed and working
- [ ] EventDetail shows all required sections
- [ ] TrendsPanel renders two charts correctly
- [ ] Dashboard integrates both components
- [ ] Event selection updates detail view
- [ ] Related events clickable and update selection
- [ ] Charts responsive and data calculations accurate
- [ ] Human verification passed
- [ ] Phase 5 complete - all 4 plans delivered
</verification>

<success_criteria>
- All tasks completed
- EventDetail component with full event info, risk breakdown, sanctions, metadata, related events
- TrendsPanel with risk over time chart and events by category chart
- Dashboard fully integrated with trends + detail panel
- Charts responsive and interactive (tooltips, hover states)
- Event selection drives detail view updates
- Related events clickable
- Clean, professional UI
- Phase 5: Dashboard & Events Feed complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard-events-feed/05-04-SUMMARY.md`:

# Phase 5 Plan 4: Detail Panel & Trends Summary

**[One-line description of what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]
- [Key outcome 3]

## Files Created/Modified

- `frontend/package.json` - Added recharts
- `frontend/src/components/EventDetail.tsx` - Comprehensive event detail view
- `frontend/src/components/EventDetail.css` - Detail panel styling
- `frontend/src/components/TrendsPanel.tsx` - Risk trend and category charts
- `frontend/src/components/TrendsPanel.css` - Charts styling
- `frontend/src/pages/Dashboard.tsx` - Integrated detail panel and trends

## Decisions Made

[Chart types, data grouping strategy, related events algorithm, etc.]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 5 complete. Dashboard provides:
- ✅ Risk-prioritized event feed with virtualized scrolling
- ✅ Split-view layout (list + detail)
- ✅ Multi-dimensional filtering (severity, risk, sanctions, type, time)
- ✅ State persistence (localStorage + URL)
- ✅ Live updates (60s polling)
- ✅ Comprehensive event details with risk breakdown
- ✅ Trend visualization (risk over time, category distribution)
- ✅ Related events discovery
- ✅ Clean, Linear-inspired aesthetic

Ready for Phase 6: Entity Watch (people, companies, governments tracking)
</output>
