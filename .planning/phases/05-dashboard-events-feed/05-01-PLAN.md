---
phase: 05-dashboard-events-feed
plan: 01
type: execute
---

<objective>
Build API integration layer for risk intelligence events with TypeScript interfaces and React hooks.

Purpose: Establish typed data fetching foundation that dashboard components will consume.
Output: Working API client with TypeScript interfaces, custom hooks for fetching/polling events, sanctions data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-dashboard-events-feed/05-CONTEXT.md
@backend/docs/risk-intelligence-api.md
@frontend/src/lib/api.ts

**Tech stack available:**
- React 19.2.0 with TypeScript
- Vite dev server with proxy to Django backend at /api
- Existing api.ts pattern: fetch with credentials: 'include', error handling

**Established patterns:**
- API client functions in frontend/src/lib/api.ts
- TypeScript interfaces colocated with API methods
- credentials: 'include' for all API calls (session auth)

**Constraining decisions:**
- Phase 4: Risk Intelligence API at /api/risk/events with 9-dimensional filtering
- Phase 4: Risk scores 0-100 (not 0-1), severity SEV1_CRITICAL through SEV5_MINIMAL
- Phase 4: Sanctions matches prefetched to avoid N+1 queries
- Phase 1: Vite proxy configured, API calls use relative paths /api/...
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TypeScript interfaces for risk events and API responses</name>
  <files>frontend/src/lib/types.ts</files>
  <action>
Create TypeScript interfaces matching the Risk Intelligence API schema from backend/docs/risk-intelligence-api.md:

**RiskEvent interface:**
- id: string (UUID)
- source: string
- event_type: string
- timestamp: string (ISO 8601)
- title: string
- summary: string
- content: Record<string, any> (flexible JSON)
- risk_score: number (0-100)
- severity: 'SEV1_CRITICAL' | 'SEV2_HIGH' | 'SEV3_MEDIUM' | 'SEV4_LOW' | 'SEV5_MINIMAL'
- sentiment: number (-1 to 1)
- urgency: 'immediate' | 'high' | 'medium' | 'low'
- themes: string[]
- entities: string[]
- sanctions_matches: SanctionsMatch[]

**SanctionsMatch interface:**
- entity_name: string
- entity_type: 'person' | 'organization' | 'vessel' | 'other'
- sanctions_list: string
- match_confidence: number (0-1)

**EventFilterParams interface (query params):**
- severity?: string (comma-separated)
- min_risk_score?: number
- max_risk_score?: number
- has_sanctions?: boolean
- event_type?: string
- source?: string
- days_back?: number
- limit?: number
- offset?: number

**SanctionsSummary interface:**
- total_matches: number
- by_entity_type: Record<string, number>
- by_list: Record<string, number>

Export all interfaces. Use descriptive JSDoc comments.
  </action>
  <verify>npx tsc --noEmit passes with no errors in types.ts</verify>
  <done>All API response types defined, no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 2: Extend API client with risk events endpoints</name>
  <files>frontend/src/lib/api.ts</files>
  <action>
Add risk intelligence methods to the existing api object (don't replace existing auth methods):

**api.getRiskEvents(filters?: EventFilterParams): Promise<RiskEvent[]>**
- Constructs query string from filters (URLSearchParams)
- Fetches GET /api/risk/events with credentials: 'include'
- Returns parsed JSON as RiskEvent[]
- Throws on non-200 responses with descriptive error

**api.getSanctionsSummary(): Promise<SanctionsSummary>**
- Fetches GET /api/risk/sanctions-summary with credentials: 'include'
- Returns parsed JSON as SanctionsSummary
- Throws on non-200 responses

Import types from './types.ts'. Follow existing api method patterns (fetch with error handling, credentials: 'include').
  </action>
  <verify>npm run build succeeds, no TypeScript errors in api.ts</verify>
  <done>API methods added, TypeScript types satisfied, build passes</done>
</task>

<task type="auto">
  <name>Task 3: Create React hooks for event data fetching and polling</name>
  <files>frontend/src/hooks/useRiskEvents.ts, frontend/src/hooks/useSanctionsSummary.ts</files>
  <action>
Create two custom hooks following React 19 patterns:

**useRiskEvents(filters?: EventFilterParams, options?: { pollInterval?: number })**
- Returns: { events: RiskEvent[] | null, loading: boolean, error: Error | null, refetch: () => void }
- Uses useState for events/loading/error state
- Uses useEffect to fetch on mount and when filters change
- If pollInterval provided, sets up setInterval for live updates (clear on unmount)
- Calls api.getRiskEvents(filters)
- Sets loading=true before fetch, loading=false after
- On error, sets error state and logs to console

**useSanctionsSummary()**
- Returns: { summary: SanctionsSummary | null, loading: boolean, error: Error | null }
- Uses useState for summary/loading/error state
- Uses useEffect to fetch on mount
- Calls api.getSanctionsSummary()
- Sets loading=true before fetch, loading=false after
- On error, sets error state

Both hooks should handle cleanup (abort controllers for fetch, clear intervals).
  </action>
  <verify>npm run build succeeds, hooks export correct types</verify>
  <done>Both hooks created, TypeScript types correct, cleanup implemented</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] npx tsc --noEmit passes
- [ ] All TypeScript interfaces match backend API schema
- [ ] API methods follow existing patterns (credentials, error handling)
- [ ] Hooks use proper React 19 patterns (useState, useEffect, cleanup)
</verification>

<success_criteria>
- All tasks completed
- TypeScript interfaces for risk events, sanctions, filters defined
- API client methods for events and sanctions summary
- React hooks for data fetching with loading/error states
- Hooks support polling for live updates
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard-events-feed/05-01-SUMMARY.md`:

# Phase 5 Plan 1: API Integration & Data Layer Summary

**[One-line description of what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]
- [Key outcome 3]

## Files Created/Modified

- `frontend/src/lib/types.ts` - TypeScript interfaces for risk events, sanctions, filters
- `frontend/src/lib/api.ts` - Risk intelligence API methods
- `frontend/src/hooks/useRiskEvents.ts` - Hook for fetching/polling events
- `frontend/src/hooks/useSanctionsSummary.ts` - Hook for sanctions summary

## Decisions Made

[Any decisions made during implementation, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 05-02-PLAN.md (Dashboard Layout & Event List)
</output>
