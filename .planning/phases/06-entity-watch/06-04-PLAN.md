---
phase: 06-entity-watch
plan: 04
type: execute
---

<objective>
Build React Entity Watch dashboard with trending leaderboard (metric toggles), entity profile card, and navigation integration.

Purpose: Create entity-centric intelligence view showing "who's important right now" with automatic discovery from event stream
Output: "Entities" page with leaderboard, metric toggles, profile detail panel, integrated into main navigation
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-entity-watch/06-CONTEXT.md
@.planning/phases/06-entity-watch/DISCOVERY.md
@.planning/phases/06-entity-watch/06-01-SUMMARY.md
@.planning/phases/06-entity-watch/06-02-SUMMARY.md
@.planning/phases/06-entity-watch/06-03-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/pages/Dashboard.tsx
@frontend/src/lib/api.ts
@backend/docs/entity-api.md

**From Plan 06-03:**
- Entity API at /api/entities/trending, /api/entities/{id}, /api/entities/{id}/timeline
- Metric toggles: mentions, risk, sanctions
- EntitySchema, EntityProfileSchema response types

**From Phase 5:**
- Dashboard with split-view layout (list + detail panel)
- FilterBar pattern for UI controls
- EventCard/EventDetail pattern for list items and detail views
- TrendsPanel with Recharts visualization
- Linear-inspired aesthetic (clean, minimal, data-focused)

**From 06-CONTEXT.md:**
- Discovery-only interface (no manual entity creation)
- Entity leaderboard with metric toggles
- Separate "Entities" tab in navigation (not sub-page of Dashboard)
- Basic profile card: entity type, sanctions status, risk score, mention count, recent events
- Lightweight and scannable like a sports leaderboard

**Design requirements:**
- Entities page route at /entities
- Top bar with metric toggle buttons (Most Mentioned, Highest Risk, Recently Sanctioned)
- Left panel: Entity leaderboard (name, type, score/count, rank badge)
- Right panel: Entity profile card when clicked (overview, recent events, sanctions status)
- Match Phase 5 aesthetic (same CSS variables, Linear-inspired)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TypeScript types and API client for entities</name>
  <files>frontend/src/lib/types.ts, frontend/src/lib/api.ts</files>
  <action>
In frontend/src/lib/types.ts, add entity types AFTER existing Event types:

```typescript
export interface Entity {
  id: string
  canonical_name: string
  entity_type: 'PERSON' | 'ORGANIZATION' | 'GOVERNMENT' | 'LOCATION'
  mention_count: number
  first_seen: string
  last_seen: string
  trending_score?: number
  trending_rank?: number
}

export interface EntityProfile extends Entity {
  aliases: string[]
  metadata?: Record<string, any>
  sanctions_status: boolean
  risk_score?: number
  recent_events: Array<{
    id: string
    title: string
    source: string
    event_type: string
    risk_score?: number
    severity?: string
    timestamp: string
  }>
}

export interface EntityMention {
  id: string
  raw_name: string
  match_score: number
  relevance?: number
  mentioned_at: string
  event_summary: {
    id: string
    title: string
    source: string
    event_type: string
    risk_score?: number
    severity?: string
    timestamp: string
  }
}

export interface EntityTimeline {
  entity_id: string
  canonical_name: string
  total_mentions: number
  mentions: EntityMention[]
  time_range: {
    start: string
    end: string
  }
}

export type EntityMetric = 'mentions' | 'risk' | 'sanctions'
```

In frontend/src/lib/api.ts, add entity API functions AFTER existing event functions:

```typescript
export async function fetchTrendingEntities(
  metric: EntityMetric = 'mentions',
  limit: number = 50,
  entityType?: string
): Promise<Entity[]> {
  const params = new URLSearchParams({
    metric,
    limit: limit.toString(),
    ...(entityType && { entity_type: entityType })
  })
  const response = await fetch(`${API_BASE_URL}/entities/trending?${params}`)
  if (!response.ok) throw new Error('Failed to fetch trending entities')
  return response.json()
}

export async function fetchEntityProfile(entityId: string): Promise<EntityProfile> {
  const response = await fetch(`${API_BASE_URL}/entities/${entityId}`)
  if (!response.ok) throw new Error('Failed to fetch entity profile')
  return response.json()
}

export async function fetchEntityTimeline(
  entityId: string,
  days: number = 30
): Promise<EntityTimeline> {
  const response = await fetch(`${API_BASE_URL}/entities/${entityId}/timeline?days=${days}`)
  if (!response.ok) throw new Error('Failed to fetch entity timeline')
  return response.json()
}
```
  </action>
  <verify>TypeScript compiles without errors, types match API response schemas</verify>
  <done>Entity types and API client functions defined, consistent with backend schemas</done>
</task>

<task type="auto">
  <name>Task 2: Create EntityLeaderboard and EntityProfile components</name>
  <files>frontend/src/components/EntityLeaderboard.tsx, frontend/src/components/EntityLeaderboard.css, frontend/src/components/EntityProfile.tsx, frontend/src/components/EntityProfile.css</files>
  <action>
Create frontend/src/components/EntityLeaderboard.tsx:
- Props: entities: Entity[], selectedId: string | null, onSelect: (id: string) => void
- Render entity list like EventList (virtualized if >50 items using react-window)
- Each row shows: rank badge (#1, #2, etc.), canonical_name (bold), entity_type badge, metric value (mention_count or risk_score)
- Highlight selected entity with border/background
- Use same styling pattern as EventCard (clean, scannable)

Create frontend/src/components/EntityLeaderboard.css:
- Similar structure to EventList.css
- Rank badge: circular, small, positioned left
- Entity type badge: pill shape, color-coded (PERSON=blue, ORGANIZATION=purple, GOVERNMENT=red, LOCATION=green)
- Metric value: right-aligned, large font
- Hover state with subtle background change
- Selected state with accent border

Create frontend/src/components/EntityProfile.tsx:
- Props: entityId: string
- Fetch EntityProfile and EntityTimeline on mount
- Show loading state while fetching
- Layout sections:
  1. Header: canonical_name (large), entity_type badge, trending_rank badge
  2. Overview: mention_count, risk_score (with color), sanctions_status (red warning if true), first_seen/last_seen dates
  3. Aliases: List of alternate names if aliases.length > 0
  4. Recent Events: List of 5 recent events (title, source, timestamp, risk score)
  5. Timeline Chart (optional): Mini line chart of mentions over time using Recharts (reuse TrendsPanel pattern)
- Error state if fetch fails
- Similar visual style to EventDetail (sections with headers, clean hierarchy)

Create frontend/src/components/EntityProfile.css:
- Similar structure to EventDetail.css
- Section headers with bottom border
- Overview stats in grid (2 columns)
- Sanctions warning: red background, bold text
- Recent events list: compact cards with hover
- Use CSS variables for colors (--risk-critical, --risk-high, etc.)
  </action>
  <verify>Components render correctly, TypeScript compiles, CSS matches Linear aesthetic</verify>
  <done>EntityLeaderboard and EntityProfile components created with clean, data-focused design</done>
</task>

<task type="auto">
  <name>Task 3: Create Entities page and integrate into navigation</name>
  <files>frontend/src/pages/Entities.tsx, frontend/src/pages/Entities.css, frontend/src/App.tsx, frontend/src/pages/Dashboard.tsx</files>
  <action>
Create frontend/src/pages/Entities.tsx:
- State: selectedMetric: EntityMetric ('mentions' default), selectedEntityId: string | null, entities: Entity[]
- Fetch trending entities on mount and when selectedMetric changes
- Layout: Split-view like Dashboard
  - Top bar: Title "Entity Watch" + metric toggle buttons (Most Mentioned, Highest Risk, Recently Sanctioned)
  - Left panel (40%): EntityLeaderboard with entities list
  - Right panel (60%): EntityProfile if selectedEntityId, else placeholder "Select an entity to view profile"
- Metric toggle buttons: Radio button style (only one active), update selectedMetric on click
- Use same layout classes as Dashboard for consistency

Create frontend/src/pages/Entities.css:
- Similar structure to Dashboard layout
- Split-view grid: 40% left, 60% right
- Top bar with metric toggles: horizontal button group, active button highlighted
- Metric toggle buttons: pill-shaped, hover state, active state with accent color
- Responsive: Stack vertically on mobile (<768px)

Update frontend/src/App.tsx:
- Add React Router: import { BrowserRouter, Routes, Route, Link } from 'react-router-dom'
- Wrap Dashboard and Entities in Routes:
  ```tsx
  <BrowserRouter>
    <nav>
      <Link to="/">Dashboard</Link>
      <Link to="/entities">Entities</Link>
    </nav>
    <Routes>
      <Route path="/" element={<Dashboard />} />
      <Route path="/entities" element={<Entities />} />
    </Routes>
  </BrowserRouter>
  ```
- Navigation styling: horizontal tabs, active state, minimal design
- Only show nav if user is authenticated

Update frontend/package.json if react-router-dom not installed:
- Add react-router-dom dependency: npm install react-router-dom

Test navigation:
- Visit http://localhost:5173/ (Dashboard)
- Click "Entities" tab → http://localhost:5173/entities
- Verify both pages render correctly
- Test metric toggle switches data
- Click entity in leaderboard → profile loads in right panel
  </action>
  <verify>Navigation works, Entities page renders, metric toggles update data, entity selection shows profile</verify>
  <done>Entities page integrated into app navigation, full entity watch UI functional</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Entity Watch dashboard with leaderboard, metric toggles, and profile views</what-built>
  <how-to-verify>
1. Start dev servers:
   ```bash
   # Terminal 1: Backend
   cd backend && python manage.py runserver

   # Terminal 2: Frontend
   cd frontend && npm run dev
   ```

2. Visit http://localhost:5173/ and login

3. Click "Entities" tab in navigation

4. Test Entity Leaderboard:
   - Verify entity list loads with names, types, ranks
   - Check rank badges (#1, #2, etc.) display correctly
   - Verify entity type badges color-coded (PERSON, ORGANIZATION, etc.)

5. Test Metric Toggles:
   - Click "Most Mentioned" → leaderboard sorted by mention count
   - Click "Highest Risk" → leaderboard sorted by risk score
   - Click "Recently Sanctioned" → leaderboard filtered to sanctioned entities

6. Test Entity Profile:
   - Click entity in leaderboard → profile loads in right panel
   - Verify profile shows: name, type, stats (mentions, risk, sanctions)
   - Check recent events list displays correctly
   - If entity has sanctions → red warning visible

7. Test Responsive Design:
   - Resize browser window → layout stacks vertically on mobile

8. Visual Quality:
   - Matches Linear aesthetic (clean, minimal, data-focused)
   - Consistent with Dashboard styling
   - No layout issues or visual bugs
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Entity types and API client functions in lib/types.ts and lib/api.ts
- [ ] EntityLeaderboard and EntityProfile components created
- [ ] Entities page with split-view layout and metric toggles
- [ ] Navigation integrated (Dashboard + Entities tabs)
- [ ] Manual testing confirms all interactions work
- [ ] Visual design matches Phase 5 aesthetic
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Human verification approved
- No errors or warnings introduced
- Entity Watch fully functional: leaderboard, metric toggles, profiles
- Navigation between Dashboard and Entities works seamlessly
- Phase 6 complete and ready for Phase 7 (AI Chat Interface)
  </success_criteria>

<output>
After completion, create `.planning/phases/06-entity-watch/06-04-SUMMARY.md`:

# Phase 6 Plan 4: Frontend Entity Leaderboard & Profiles Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description
- `path/to/another.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Phase Complete

**Phase 6: Entity Watch** is complete.

All entity tracking infrastructure working:
- ✅ Entity models with fuzzy name matching (Plan 06-01)
- ✅ Entity extraction Celery tasks with trending service (Plan 06-02)
- ✅ Entity API endpoints with metric toggles (Plan 06-03)
- ✅ Frontend entity leaderboard and profiles (Plan 06-04)

**Entity Watch now providing:**
- Auto-discovery of important entities from event stream
- Trending leaderboard with 3 metric views (mentions, risk, sanctions)
- Fuzzy name normalization (e.g., "Nicolás Maduro" = "N. Maduro")
- Entity profiles with stats, sanctions status, recent events
- Time-decayed trending scores (7-day half-life)
- Integrated navigation with Dashboard

**Ready for next phase**: Phase 7 - AI Chat Interface (assistant-ui integration for natural language queries)
</output>
