---
phase: 26-gkg-theme-population-entity-relationship-graphs-event-lineage-tracking
plan: 02
type: execute
---

<objective>
Build interactive entity relationship graph visualization with Reagraph WebGL renderer.

Purpose: Create frontend graph component that visualizes entity networks with auto-focus on high-risk clusters, directional weighted edges, and click handlers for exploration.
Output: Working GraphPage with Reagraph visualization showing entity relationships and community clusters.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-gkg-theme-population-entity-relationship-graphs-event-lineage-tracking/26-RESEARCH.md
@.planning/phases/26-gkg-theme-population-entity-relationship-graphs-event-lineage-tracking/26-CONTEXT.md
@.planning/phases/26-gkg-theme-population-entity-relationship-graphs-event-lineage-tracking/26-01-SUMMARY.md

**Phase context:**
- Auto-focus on high-risk clusters when opening graph (CONTEXT.md)
- Directional and weighted edges (relationship strength)
- Click entities to navigate to profile, click edges to see narratives (Plan 26-03)

**Tech stack from RESEARCH.md:**
- Reagraph (WebGL, 92.6 benchmark score) - primary choice for 1K-5K nodes
- Don't hand-roll force-directed layout - use Reagraph layoutType="forceDirected2d"
- Don't hand-roll graph rendering - WebGL is 2-3x faster than Canvas

**Frontend stack:**
- React 18, TypeScript, Vite
- Mantine UI (Phase 9-11 for components)
- React Query for data fetching (Phase 10)
- React Router for navigation (Phase 6)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Reagraph and Graphology dependencies</name>
  <files>frontend/package.json</files>
  <action>
Install graph visualization libraries:

```bash
cd frontend
npm install reagraph graphology
```

Reagraph: WebGL-based graph visualization (RESEARCH.md primary recommendation)
Graphology: Graph data structures (used by Reagraph internally, good to have explicit dependency)

Don't install react-force-graph or Sigma.js - Reagraph is the chosen library for this phase (better benchmark score, React-first API). Don't install Cytoscape.js - heavier and not WebGL-optimized.
  </action>
  <verify>npm list reagraph graphology shows installed versions without peer dependency warnings</verify>
  <done>package.json updated with reagraph and graphology dependencies, npm install succeeds</done>
</task>

<task type="auto">
  <name>Task 2: Create EntityGraph component with Reagraph</name>
  <files>frontend/src/components/EntityGraph/EntityGraph.tsx, frontend/src/components/EntityGraph/useGraphData.ts</files>
  <action>
Create EntityGraph component using Reagraph GraphCanvas:

**useGraphData.ts hook:**
- Use React Query to fetch /api/graph/entities
- Transform API response to maintain structure (already in Reagraph format from backend)
- Return {nodes, edges, highRiskCluster, loading, error}

**EntityGraph.tsx:**
```tsx
import { GraphCanvas } from 'reagraph';
import { useGraphData } from './useGraphData';
import { useNavigate } from 'react-router-dom';

export const EntityGraph = () => {
  const { nodes, edges, highRiskCluster, loading } = useGraphData();
  const navigate = useNavigate();
  const [selectedEdge, setSelectedEdge] = useState(null);

  if (loading) return <Skeleton height={600} />;

  return (
    <GraphCanvas
      nodes={nodes}
      edges={edges}
      layoutType="forceDirected2d"
      sizingType="centrality"  // Auto-size nodes by importance
      clusterAttribute="community"  // Use community from backend
      draggable={true}

      // Directional weighted edges (CONTEXT.md requirement)
      edgeInterpolation="curved"
      edgeArrowPosition="end"

      // Visual styling
      theme={{
        node: {
          fill: (node) => node.data.sanctions_status ? '#DC2626' : getRiskColor(node.data.risk_score),
          activeFill: '#3B82F6'
        },
        edge: {
          fill: '#94A3B8',
          width: (edge) => Math.log(edge.weight + 1) * 2  // Log scale for edge thickness
        }
      }}

      // Click handlers
      onNodeClick={(node) => {
        navigate(`/entities/${node.id}`);  // Navigate to entity profile (Phase 6)
      }}
      onEdgeClick={(edge) => {
        setSelectedEdge(edge);  // Open narrative modal (Plan 26-03)
      }}

      // Auto-focus on high-risk cluster (CONTEXT.md requirement)
      // TODO: Implement camera focus on highRiskCluster nodes after render
    />
  );
};
```

**getRiskColor(score: number):** Helper that maps risk score to color (>70 red, 50-70 orange, <50 blue) - follow Phase 10 patterns.

Don't implement camera auto-focus in this task - that's a Reagraph API exploration for later. Basic visualization first.

Use Mantine Skeleton for loading state (Phase 9 component library).
  </action>
  <verify>Component renders without errors, displays graph when data loads, nodes are clickable</verify>
  <done>EntityGraph component renders Reagraph visualization, shows entity nodes with risk-based colors, edges with weights, click handlers registered</done>
</task>

<task type="auto">
  <name>Task 3: Create GraphPage route and integrate with navigation</name>
  <files>frontend/src/pages/GraphPage.tsx, frontend/src/App.tsx</files>
  <action>
Create GraphPage with full-screen graph layout:

**GraphPage.tsx:**
```tsx
import { Container, Title, Box } from '@mantine/core';
import { EntityGraph } from '@/components/EntityGraph/EntityGraph';

export const GraphPage = () => {
  return (
    <Container fluid style={{ height: 'calc(100vh - 60px)' }}>
      <Box mb="md">
        <Title order={2}>Entity Relationship Graph</Title>
        <Text size="sm" c="dimmed">Network visualization of entity connections and risk clusters</Text>
      </Box>

      <Box style={{ height: 'calc(100% - 80px)', border: '1px solid var(--mantine-color-gray-3)', borderRadius: 4 }}>
        <EntityGraph />
      </Box>
    </Container>
  );
};
```

**App.tsx route:**
Add to React Router (Phase 6 pattern):
```tsx
<Route path="/graph" element={<GraphPage />} />
```

**Navigation link (optional):**
If navigation menu exists, add "Graph" link to main nav.

Follow Phase 11 Container fluid pattern for full-width layouts. Use Mantine Box for graph container with fixed height.

Don't add filters/controls in this task - ThemeFilter component comes in Plan 26-04. Basic page first.
  </action>
  <verify>Visit http://localhost:5173/graph, page loads with graph visualization, no console errors</verify>
  <done>GraphPage route functional, graph renders full-screen, accessible via /graph URL, integrated with app navigation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm install succeeds without warnings
- [ ] EntityGraph component renders graph visualization
- [ ] Nodes colored by risk score and sanctions status
- [ ] Edges show directional arrows with weight-based thickness
- [ ] Click node navigates to entity profile
- [ ] GraphPage accessible at /graph route
- [ ] No TypeScript errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Interactive graph visualization functional
- Auto-sizing and clustering working (via Reagraph built-ins)
- Click handlers navigate correctly
- Ready for LLM narrative integration (Plan 26-03)
</success_criteria>

<output>
After completion, create `.planning/phases/26-gkg-theme-population-entity-relationship-graphs-event-lineage-tracking/26-02-SUMMARY.md`
</output>
