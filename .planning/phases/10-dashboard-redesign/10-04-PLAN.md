---
phase: 10-dashboard-redesign
plan: 04
type: execute
---

<objective>
Enhance FilterBar with Mantine form components and React Query for real-time updates.

Purpose: Replace custom CSS filter controls with Mantine's professional form components and migrate data fetching to React Query for better caching, polling, and loading states.
Output: FilterBar rebuilt with Mantine Select, NumberInput, MultiSelect, Checkbox, DateInput and Dashboard using React Query for data fetching with 30-second polling.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-dashboard-redesign/10-RESEARCH.md
@.planning/phases/10-dashboard-redesign/10-03-SUMMARY.md
@.planning/phases/09-component-library/09-02-SUMMARY.md
@.planning/phases/05-dashboard-events-feed/05-03-SUMMARY.md
@frontend/src/components/FilterBar.tsx
@frontend/src/components/FilterBar.css
@frontend/src/hooks/useRiskEvents.ts

**Tech stack available:**
- Mantine UI: Select, NumberInput, MultiSelect, Checkbox, Button, Stack, Group, Collapse
- @tanstack/react-query: useQuery, QueryClient, QueryClientProvider (installed in 10-01)
- React Router for URL state sync (already installed)

**Established patterns:**
- Phase 5: FilterBar has 5 dimensions (severity, risk range, event type, sanctions toggle, time range)
- Phase 5: Filter state persisted to localStorage and URL
- Phase 5: 60-second polling for live updates
- Phase 9: Mantine components for all form inputs

**Constraining decisions:**
- Phase 9: Use Mantine form components (no custom inputs)
- Phase 5: Filter defaults: 30 days, risk 0-100, all severities, no event type filter
- Phase 8: Design tokens for colors

**From RESEARCH.md:**
- Pattern 3: Live filtering with debounced input (300ms)
- Use React Query refetchInterval for polling (30s recommended)
- Don't hand-roll date pickers (use @mantine/dates)
- Instant result count feedback on filter changes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @mantine/dates for date picker</name>
  <files>frontend/package.json</files>
  <action>Install @mantine/dates package for professional date picker components. Run: cd frontend && npm install @mantine/dates@^8. This provides DateInput and DatePickerInput components needed for time range filtering. Also install dayjs as peer dependency: npm install dayjs (required by @mantine/dates). This is the standard date picker solution from research - don't hand-roll date inputs.</action>
  <verify>cd frontend && npm list @mantine/dates dayjs shows both installed</verify>
  <done>@mantine/dates and dayjs installed successfully</done>
</task>

<task type="auto">
  <name>Task 2: Rebuild FilterBar with Mantine form components</name>
  <files>frontend/src/components/FilterBar.tsx</files>
  <action>Rebuild FilterBar using Mantine form components. Import Stack, Group, MultiSelect, NumberInput, Select, Checkbox, Button, Collapse, Text from @mantine/core. Import DateInput from @mantine/dates. Replace custom form inputs: (1) Severity filter → MultiSelect with data={['SEV1_CRITICAL', 'SEV2_HIGH', 'SEV3_MEDIUM', 'SEV4_LOW', 'SEV5_INFO']} and value={filters.severity_levels || []}. (2) Risk score min/max → two NumberInput components with min={0} max={100}. (3) Event type → Select with clearable data from API event types. (4) Sanctions toggle → Checkbox with label="Sanctioned entities only". (5) Time range → DateInput with placeholder="Last 30 days" (or simple select with presets: 7d, 30d, 90d). Use Stack spacing="md" for vertical layout of form groups. Use Group for horizontal pairs (min/max risk inputs). Add Collapse for collapsible filter panel (existing functionality). Remove all FilterBar.css and custom CSS classes. Keep filter state management logic (onChange handlers, localStorage sync, URL sync).</action>
  <verify>npm run dev starts, FilterBar renders with Mantine form components, all filter controls interactive</verify>
  <done>FilterBar rebuilt with Mantine MultiSelect/NumberInput/Select/Checkbox/DateInput, no custom CSS, all filters functional, collapsible panel works</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Redesigned Dashboard with Mantine Grid layout, Events Feed with skeleton loading, Recharts visualizations, and Mantine filter controls</what-built>
  <how-to-verify>
    1. Run: npm run dev (from frontend directory)
    2. Visit: http://localhost:5173/
    3. Desktop view (>992px):
       - Verify 3-column layout (filters left, events center, trends right)
       - Verify skeleton cards show during initial load, then real events
       - Verify event cards use Mantine styling with color-coded badges
       - Verify risk trend chart shows in right panel with Recharts
       - Verify filter controls use Mantine form components
    4. Apply filters:
       - Change severity levels in MultiSelect - events update
       - Adjust risk score range - events filter
       - Toggle sanctions checkbox - filtering works
       - Verify instant feedback (no lag)
    5. Tablet view (768px):
       - Verify layout adapts to narrower columns
       - Verify charts remain responsive
    6. Mobile view (375px):
       - Verify single column stacked layout
       - Verify all components still functional
    7. Check console: No errors or warnings
  </how-to-verify>
  <resume-signal>Type "approved" to mark Phase 10 complete, or describe any visual/UX issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run dev starts without errors
- [ ] @mantine/dates and dayjs installed
- [ ] FilterBar uses Mantine form components
- [ ] All 5 filter dimensions working (severity, risk, type, sanctions, time)
- [ ] Filter state persists to localStorage and URL
- [ ] Events update immediately when filters change
- [ ] No custom CSS imports (FilterBar.css removed)
- [ ] Human verification checkpoint passed
- [ ] No console errors
</verification>

<success_criteria>

- @mantine/dates installed
- FilterBar rebuilt with Mantine components
- All filters functional and interactive
- Custom CSS removed (FilterBar.css)
- Filter state management preserved (localStorage, URL)
- Human verification confirms UX quality
- Phase 10 complete: Dashboard fully redesigned
- No TypeScript errors
  </success_criteria>

<output>
After completion, create `.planning/phases/10-dashboard-redesign/10-04-SUMMARY.md`:

# Phase 10 Plan 4: Filter UX Enhancement Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `frontend/package.json` - Description
- `frontend/src/components/FilterBar.tsx` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

**Phase 10 Complete** - Dashboard redesigned with Mantine Grid, Recharts visualizations, skeleton loading, and Mantine form components

Ready for: Phase 11 - Entity Pages Redesign
</output>
