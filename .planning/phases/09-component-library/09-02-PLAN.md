---
phase: 09-component-library
plan: 02
type: execute
---

<objective>
Build container and overlay UI components (Card, Modal, Table) with accessibility and design tokens.

Purpose: Complete core component library with layout containers, accessible dialogs, and virtualized tables for data display.
Output: Card, Modal, and Table components documented in Storybook, ready for use in Dashboard/Entity pages redesign (Phases 10-11).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-component-library/09-RESEARCH.md
@.planning/phases/09-component-library/09-01-SUMMARY.md
@frontend/src/components/ui/Button/Button.tsx
@frontend/src/styles/tokens/colors.css
@frontend/src/styles/tokens/spacing.css

**Tech stack available:**
- Radix UI installed (from 09-01)
- @tanstack/react-virtual 3.13.18 (from Phase 6 Entity tracking)
- Button component (from 09-01)
- Design tokens established (Phase 8)

**Established patterns (from 09-01):**
- `src/components/ui/` directory for base components
- Compound component pattern with Radix primitives
- Design tokens via CSS variables
- Ref forwarding with TypeScript
- Barrel exports (index.ts)

**Constraining decisions:**
- Phase 6: @tanstack/react-virtual already used for entity leaderboard
- Phase 6: Virtualized leaderboard using @tanstack/react-virtual for performance
- Phase 8: Design tokens for styling (colors, spacing, typography)

**From RESEARCH.md:**
- Don't hand-roll: Focus trap (use Radix Dialog), keyboard navigation
- Modal pattern: Radix Dialog with Portal, Overlay, Content, Title, Description
- Table pattern: Use existing @tanstack/react-virtual for 100+ rows
- Common pitfall: Focus not restored after modal close (Radix handles this)
- Anti-pattern: Not forwarding refs for Radix primitives
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Card component with compound pattern</name>
  <files>frontend/src/components/ui/Card/Card.tsx, frontend/src/components/ui/Card/index.ts</files>
  <action>
    Create Card compound component for content containers.

    **Structure:**
    - `Card.Root` - Main container with border, padding, background
    - `Card.Header` - Optional header section
    - `Card.Title` - Title text with heading semantics (h3)
    - `Card.Description` - Subtitle/description text
    - `Card.Content` - Main content area
    - `Card.Footer` - Optional footer section

    **Implementation:**
    - Use native HTML elements (div, h3, p)
    - Style with design tokens: border (--border-neutral), background (--color-bg-primary), spacing (--spacing-*)
    - Border radius from Phase 8 tokens (--border-radius-md = 4px, reduced per user feedback)
    - Shadow from --shadow-sm for subtle elevation
    - Forward refs for all sub-components
    - Export all parts plus default Card.Root

    **API example:**
    ```tsx
    <Card.Root>
      <Card.Header>
        <Card.Title>Title</Card.Title>
        <Card.Description>Subtitle</Card.Description>
      </Card.Header>
      <Card.Content>Main content here</Card.Content>
      <Card.Footer>Footer actions</Card.Footer>
    </Card.Root>
    ```

    Do NOT use excessive nesting - keep structure flat for flexibility.
  </action>
  <verify>
    ```bash
    cd frontend && npm run build
    ```
    TypeScript compiles. Card exports all sub-components.
  </verify>
  <done>Card component created with Root/Header/Title/Description/Content/Footer parts. Styled with design tokens. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Create Modal component with Radix Dialog and Table component</name>
  <files>frontend/src/components/ui/Modal/Modal.tsx, frontend/src/components/ui/Modal/index.ts, frontend/src/components/ui/Table/Table.tsx, frontend/src/components/ui/Table/index.ts</files>
  <action>
    **Modal component:**
    - Import Dialog from `radix-ui` (NOT individual @radix-ui/react-dialog package)
    - Export: Modal.Root (Dialog.Root), Modal.Trigger (Dialog.Trigger), Modal.Content (custom), Modal.Title (Dialog.Title), Modal.Description (Dialog.Description), Modal.Close (Dialog.Close)
    - Modal.Content wraps Dialog.Portal + Dialog.Overlay + Dialog.Content
    - Overlay: Fixed inset-0, bg-black/50, fade animation
    - Content: Centered (50% top/left, translate -50%), white bg, rounded, shadow-lg, max-width (lg = 32rem), padding
    - Use design tokens for colors, spacing, border-radius, shadows
    - Close button (X icon) in top-right using Button from 09-01
    - Radix handles: Focus trap, Esc key, focus restoration, scroll lock, ARIA attributes
    - Do NOT implement custom focus management - Radix Dialog handles it

    **Table component:**
    - Wrapper around native `<table>` element with optional virtualization
    - Props: data (array), columns (array), virtualized (boolean, default false)
    - If virtualized=true, use `@tanstack/react-virtual` useVirtualizer hook (already in package.json from Phase 6)
    - Style with design tokens: borders, spacing, hover states
    - Include: thead with sortable headers (aria-sort attribute), tbody with rows
    - Responsive: Horizontal scroll on mobile (overflow-x-auto wrapper)
    - Do NOT rebuild virtualization - reuse @tanstack/react-virtual pattern from Phase 6

    **TypeScript types:**
    - Modal: Extend React.ComponentPropsWithoutRef<typeof Dialog.Content> for Modal.Content
    - Table: Define TableProps<T> generic for data typing
  </action>
  <verify>
    ```bash
    cd frontend && npm run build
    ```
    Both components compile. Modal exports all Dialog parts. Table supports virtualization.
  </verify>
  <done>Modal component uses Radix Dialog with Portal/Overlay/Content. Table component created with @tanstack/react-virtual integration. Build passes.</done>
</task>

<task type="auto">
  <name>Task 3: Add Storybook stories for Card, Modal, and Table</name>
  <files>frontend/src/stories/Components/Card.stories.tsx, frontend/src/stories/Components/Modal.stories.tsx, frontend/src/stories/Components/Table.stories.tsx</files>
  <action>
    Create Storybook documentation for all three components.

    **Card.stories.tsx:**
    - Stories: Default (with all parts), HeaderOnly, ContentOnly, WithFooter
    - Demonstrate compound pattern flexibility
    - Show design token usage (borders, shadows, spacing)

    **Modal.stories.tsx:**
    - Stories: Default (with title/description), WithForm, LongContent (scroll test)
    - Demonstrate keyboard interaction (Esc closes, focus trap works)
    - Show overlay fade animation
    - Include accessibility note: Focus restored to trigger on close

    **Table.stories.tsx:**
    - Stories: BasicTable (10 rows), LargeTable (100+ rows, virtualized), SortableHeaders
    - Demo data: Use sample entity data (names, risk scores, sanctions status)
    - Demonstrate virtualized scrolling with @tanstack/react-virtual
    - Show responsive behavior (horizontal scroll on small viewport)

    All stories:
    - Use Storybook 10 API (Meta, StoryObj)
    - Include controls for prop testing
    - Follow pattern from 09-01 Button/Input stories
    - Use theme decorator for light/dark testing
  </action>
  <verify>
    ```bash
    cd frontend && npm run storybook
    ```
    Storybook starts. Visit localhost:6006, verify Components/Card, Components/Modal, Components/Table appear with all stories rendering correctly. Test Modal keyboard interaction (Esc, focus trap).
  </verify>
  <done>Card, Modal, and Table stories created. All documented in Storybook with variants and interaction demos. Storybook runs without errors.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete component library: Button, Input, Card, Modal, Table with Storybook documentation</what-built>
  <how-to-verify>
    1. Start Storybook: `cd frontend && npm run storybook`
    2. Visit: http://localhost:6006
    3. Navigate to Components section in sidebar
    4. Test Button: Click variants (primary/secondary/ghost), test sizes, verify focus ring on Tab
    5. Test Input: Type in input, trigger error state, verify label click focuses input
    6. Test Card: Verify borders, shadows, spacing match design tokens
    7. Test Modal: Click trigger, verify overlay, press Esc (closes), verify focus returns to trigger
    8. Test Table: Scroll large table, verify virtualization (smooth scrolling, no lag)
    9. Check: All components use design token colors (not hardcoded), borders match Phase 8 radius
    10. Accessibility: Tab through components, verify focus indicators, check screen reader labels
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] `npm run storybook` starts without errors
- [ ] Card component has all sub-components (Root/Header/Title/Content/Footer)
- [ ] Modal uses Radix Dialog (focus trap, Esc closes, focus restoration)
- [ ] Table integrates with @tanstack/react-virtual for virtualization
- [ ] All components styled with design tokens (CSS variables)
- [ ] Storybook shows 5 component sections (Button, Input, Card, Modal, Table)
- [ ] User verification passed (checkpoint approved)
</verification>

<success_criteria>

- All tasks completed
- Card, Modal, and Table components created
- All components use Radix primitives where appropriate
- Design tokens applied consistently
- Storybook documentation complete for all 5 components
- Accessibility features verified (keyboard nav, focus management, ARIA)
- User approved component library in Storybook
- Phase 9 complete - ready for Phase 10 (Dashboard Redesign)
</success_criteria>

<output>
After completion, create `.planning/phases/09-component-library/09-02-SUMMARY.md`:

# Phase 9 Plan 2: Container Components Summary

**Card, Modal, and Table components complete component library foundation**

## Accomplishments

- Card compound component (Root/Header/Title/Content/Footer)
- Modal with Radix Dialog (focus trap, Esc close, overlay fade)
- Table component with @tanstack/react-virtual integration
- 3 additional Storybook story files (8+ stories total)
- Full component library: Button, Input, Card, Modal, Table
- Accessibility verified: keyboard navigation, focus management, ARIA
- User verification passed in Storybook

## Files Created/Modified

- `frontend/src/components/ui/Card/Card.tsx` - Compound card component
- `frontend/src/components/ui/Card/index.ts` - Barrel export
- `frontend/src/components/ui/Modal/Modal.tsx` - Radix Dialog wrapper
- `frontend/src/components/ui/Modal/index.ts` - Barrel export
- `frontend/src/components/ui/Table/Table.tsx` - Table with virtualization
- `frontend/src/components/ui/Table/index.ts` - Barrel export
- `frontend/src/stories/Components/Card.stories.tsx` - 4+ Card stories
- `frontend/src/stories/Components/Modal.stories.tsx` - 3+ Modal stories
- `frontend/src/stories/Components/Table.stories.tsx` - 3+ Table stories

## Decisions Made

- Card uses compound pattern for flexible composition (not single monolithic component)
- Modal wraps Radix Dialog for accessibility (focus trap, Esc, restoration) - did not hand-roll
- Table reuses @tanstack/react-virtual from Phase 6 for virtualization consistency
- All components export via barrel files for clean imports
- Close button in Modal uses Button component from 09-01 (component reuse)

## Issues Encountered

[None expected - building on established patterns from 09-01]

## Next Phase Readiness

**Phase 9 Complete** - Component library foundation shipped

Deliverables:
- 5 core components: Button, Input, Card, Modal, Table
- All documented in Storybook with 20+ stories
- Design tokens integrated throughout
- Accessibility features verified
- Ready for consumption in Phase 10 (Dashboard Redesign)

**Ready for:** Phase 10 - Dashboard Redesign (rebuild Dashboard and Events Feed using new component library)

---

*Phase: 09-component-library*
*Completed: [date]*
*Component library ready for production use*
</output>
